<!DOCTYPE html>
<html>
    <meta charset="UTF-8">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>Gitit as my personal wiki</title>
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
        
    </head>
    <body>
        <div id="header">
          <div id="logo">
      <a href="../">
        <img class="img" src="../images/log0.png" />
      </a>
</div>
<div id="navigation">
  <ul>
    <li>
      <a href="../blog.html">
        Blog
        <i class="fa fa-pencil"></i>
      </a>
    </li>
    <li>
      <a href="../pages.html">
        Writing
        <i class="fa fa-globe"></i>
      </a>
    </li>
    <li>
      <a href="../worklog.html">
        Worklog
        <i class="fa fa-bar-chart"></i>
      </a>
    </li>
    <li>
      <a href="../contact.html">
        Contact
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>

        </div>
        <div id="metadata">
            <ul class="meta">
            
                <li>tags: <em><a href="../tags/wiki.html">wiki</a>, <a href="../tags/workflow.html">workflow</a></em></li>
            
            
            <li>posted: <em> July  9, 2014 </em></li>
            <li>modified: <em> November  3, 2016 </em></li>
            </ul>
        </div>
        <div id="content">
            <h1>Gitit as my personal wiki</h1>
            <div class="info">
    <!--
    <div class="snippets">
        <i class="fa fa-calendar"></i> July  9, 2014 <i class="fa fa-cut" November  3, 2016></i> November  3, 2016
    </div>
    -->
    
</div>
<div id="toc"><h2>Contents</h2>
<ul>
<li><a href="#what-i-want">What I want</a></li>
<li><a href="#gitit">Gitit</a><ul>
<li><a href="#installing">Installing</a></li>
<li><a href="#customizing">Customizing</a></li>
</ul></li>
<li><a href="#having-a-wiki">Having a wiki</a></li>
<li><a href="#moving-forward">Moving forward</a></li>
</ul> </div>
<p>I’ve wanted a personal wiki for a while now. The problem is there wasn’t any good software out there for it, or I couldn’t find it.</p>
<p>My favorite production wiki software is MediaWiki. You’ve seen it, and probably even heard about it: it runs Wikipedia, the fantastic Arch Linux Wiki, and a billion other great wiki websites out there. But it’s enterprise-grade wiki software, if you know what I mean. I’ve deployed it before with LDAP authentication. It runs on PHP. There’s a SQL backend. I don’t want that on my laptop.</p>
<p><a href="http://moinmo.in/">MoinMoin</a> is the runner-up in wiki software. <a href="http://kernelnewbies.org/">Kernel Newbies</a> uses this. So do <a href="https://wiki.ubuntu.com/">Ubuntu</a> and <a href="http://www.freedesktop.org/wiki/">Freedesktop.org</a>. It’s written in Python, so I can hack at it without feeling like I’m playing with fire. But it uses Apache’s webserver and the ugly common wiki markup that anyone who’s worked with MediaWiki or similar are used to.</p>
<section id="what-i-want" class="level2">
<h2>What I want</h2>
<ol type="1">
<li>Git backend</li>
<li>Markdown files</li>
<li>Web interface</li>
<li>Interlinked documents</li>
</ol>
<p>Give me these four things and I can sync my wiki across multiple computers, edit it in plaintext or online, and roll out pages into blog posts with minimal effort. <em>That’s</em> what I want. Even more ideally, I’d like to have <a href="http://johnmacfarlane.net/pandoc/">Pandoc</a> in the backend so I can write pages in whatever format I’d like.</p>
</section>
<section id="gitit" class="level2">
<h2>Gitit</h2>
<p>Oh wait. I’ve seen this before.</p>
<p><a href="#gitit">Gitit</a> does all that. It’s written in Haskell<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> and pages only get updated when I commit them. I can write pages in LaTeX, markdown, or anything else supported by Pandoc. I get an API that I can mess with. The server backend is <a href="http://happstack.com/page/view-page-slug/1/happstack">Happstack</a>. Why haven’t I been using this?<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
<section id="installing" class="level3">
<h3>Installing</h3>
<p>I could’ve installed it with <code>cabal</code> like a good Haskeller, but it was in the Debian repos and I don’t need it on multiple servers yet. So I did:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" data-line-number="1">$ <span class="fu">sudo</span> aptitude install gitit</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">$ <span class="fu">mkdir</span> ~/wiki <span class="kw">&amp;&amp;</span> <span class="bu">cd</span> ~/wiki</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">$ <span class="ex">gitit</span></a></code></pre></div>
<p>and I had a wiki.</p>
</section>
<section id="customizing" class="level3">
<h3>Customizing</h3>
<p>The first thing I didn’t like was that Gitit doesn’t run in the background, and it didn’t run at launch. I stopped having a <a href="https://wiki.archlinux.org/index.php/Systemd/User">systemd user config</a> (which I loved) when I moved to Debian, since even on sid the latest I can get is <a href="https://packages.debian.org/sid/systemd">systemd 204</a>. I’m not completely exactly sure what is going on under the hood with my systemd init in Debian, so I’m not about to compile 215 or something.</p>
<p>But I still want to daemonize this process. A quick Google search <a href="http://stackoverflow.com/questions/525247/how-do-i-daemonize-an-arbitrary-script-in-unix">rescued me</a>:</p>
<blockquote>
<p>You can daemonize any executable in Unix by using nohup and the &amp; operator:</p>
<p>nohup yourScript.sh script args&amp;</p>
</blockquote>
<p>There’s a script provided that uses pidfiles to ensure it only ran once. I feel like this is something I’ll eventually hack into a set of personal scripts, so I whipped out the following:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co"># Grep for a process name, excluding grep from the output.</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw">function</span><span class="fu"> psgrep()</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">    <span class="fu">ps</span> aux <span class="kw">|</span> <span class="fu">grep</span> <span class="va">$1</span> <span class="kw">|</span> <span class="fu">grep</span> -v grep</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="kw">}</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co"># Spawn a daemonized script ($1) only if it is not already started.</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co"># If $2 is provided, this will run the daemon in that folder.</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="kw">function</span><span class="fu"> daemonize_script ()</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9">    <span class="kw">if [[</span> <span class="ot">-z</span> <span class="va">$(</span><span class="ex">psgrep</span> <span class="va">$1)</span><span class="kw"> ]]</span>; <span class="kw">then</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10">        <span class="kw">if [[</span> <span class="ot">-n</span> <span class="va">$2</span><span class="kw"> ]]</span>; <span class="kw">then</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11">            <span class="va">olddir=$(</span><span class="bu">pwd</span><span class="va">)</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12">            <span class="bu">cd</span> <span class="va">$2</span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13">        <span class="kw">fi</span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14">        <span class="fu">nohup</span> <span class="va">$1</span> <span class="op">&gt;</span> /dev/null <span class="op">2&gt;&amp;1</span> <span class="kw">&amp;</span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15">        <span class="kw">if [[</span> <span class="ot">-n</span> <span class="va">$2</span><span class="kw"> ]]</span>; <span class="kw">then</span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16">            <span class="bu">cd</span> <span class="va">$olddir</span></a>
<a class="sourceLine" id="cb2-17" data-line-number="17">        <span class="kw">fi</span></a>
<a class="sourceLine" id="cb2-18" data-line-number="18">    <span class="kw">fi</span></a>
<a class="sourceLine" id="cb2-19" data-line-number="19"><span class="kw">}</span></a>
<a class="sourceLine" id="cb2-20" data-line-number="20"></a>
<a class="sourceLine" id="cb2-21" data-line-number="21"><span class="ex">daemonize_script</span> gitit ~/wiki</a></code></pre></div>
<p>This starts <code>gitit</code> once, when I start my computer, and then not again.</p>
<p>Just using <code>grep</code> like this doesn’t work if you have other processes running that have that name in them. So this is pretty weak and not as useful as pidfiles, but it got the job done as a workaround.</p>
<p>Then I realized I didn’t want <code>~/wiki</code> to have a bunch of gitit stuff in it - I just wanted the pages and Git repo. The repository is in there by default - but how to separate the Gitit data wasn’t obvious.</p>
<p>My first shot was just to move Gitit to <code>~/.gitit</code> and symlink <code>~/.gitit/wikidata</code> to <code>~/wiki</code>, which worked when I ran it manually, but it broke my simple zsh script. To complicate things more, I also needed to start Gitit with a custom config file,<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> which has to be passed as an argument like <code>gitit -f my.conf</code>. I <em>could</em> make this work with multiple arguments, but …</p>
<p>Adding a <code>start_gitit</code> script to my <code>~/bin</code> folder solved this:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co">#!/usr/bin/env bash</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="ex">gitit</span> -f <span class="va">$HOME</span>/.gitit/my.conf</a></code></pre></div>
<p>So now I’m calling</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="ex">daemonize_script</span> ~/bin/start_gitit ~/.gitit</a></code></pre></div>
<p>and that gets the job done. I’m looking forward to spending more time with my daemonizing scripts, since I know they’re worthless as-is, but eventually might prove a useful thing to have around.</p>
</section>
</section>
<section id="having-a-wiki" class="level2">
<h2>Having a wiki</h2>
<p>In my first couple of days with Gitit, I’ve started collecting useful bits of notes and categorizing them. It’s nice because Pandoc’s markdown (as opposed to, say, regular markdown) is powerful enough to give me everything I want for writing, and is overall simpler than <a href="http://orgmode.org/">org-mode</a>.</p>
<p>I made a lot of edits to the Arch Wiki last year, so I know that they’re a format that I appreciate. Interlinking documents is an awesome feature.</p>
<p>As much as I love Org-mode, I’m still learning to cope with its complexity and it’s nowhere near as portable as having a markdown wiki in my home folder.</p>
</section>
<section id="moving-forward" class="level2">
<h2>Moving forward</h2>
<p>This is a new personal project for me, so there’s still a lot of goals. If it becomes an ongoing effort of mine (I hope so!), then I should do the following:</p>
<ul>
<li>Write every day, whether it’s blog posts or notes in my wiki.
<ul>
<li>Keeping a database of personal notes should open me up to writing just for myself. I don’t do that enough as is, and it’s pretty often I wish I had a record of my old unfinished thoughts so I could build on them and review them.</li>
</ul></li>
<li><strike>Keep improving my daemonizing script.</strike> No longer necessary; I <a href="2014-07-25-all-your-daemons.html">switched to systemd user sessions</a>.
<ul>
<li><strike>Stop grepping <code>ps aux</code>; use pidfiles or something normal.</strike></li>
</ul></li>
<li>Find a nice way to link pages from my wiki to my website, so they’re ultimately just the same thing.
<ul>
<li>This’ll be hard, since they’re both separate Git repos. Maybe using submodules can get the job done, or just writing a script to do the rollover when contents change?</li>
</ul></li>
<li>Start hacking at Gitit and learning its internals.
<ul>
<li><strike>Move to cabal version instead of Debian package.</strike></li>
</ul></li>
</ul>
</section>
<section class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Like Pandoc and <a href="http://jaspervdj.be/hakyll/">Hakyll</a>, which I use for this website.<a href="#fnref1" class="footnote-back">↩</a></p></li>
<li id="fn2"><p>There was one feature it was missing when I tried it out last time. I can’t remember it anymore. It must not have mattered much.<a href="#fnref2" class="footnote-back">↩</a></p></li>
<li id="fn3"><p>There isn’t a way to let anyone edit the wiki without a config file. I’m just hosting this locally for myself, so I have no need for a user account system and might eventually figure out a way to remove it.<a href="#fnref3" class="footnote-back">↩</a></p></li>
</ol>
</section>

        </div>
        <div id="footer">
            <p>
  Content © 2012-2021 Nathan Typanski
  and licensed under a <br /><a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
  Opinions are my own and not the views of my employer.
  <a href="../website.html">About this site.</a>
<!-- p-->
<p>
  <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/80x15.png" /></a>
</p>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-37825924-1', 'nathantypanski.com');
  ga('send', 'pageview');

</script>


        </div>
    </body>
</html>
